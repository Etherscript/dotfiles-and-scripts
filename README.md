# dotfiles and scripts 

## Table of Content

* [Intro](#intro)
* [Usage](#usage)
* [配置文件部分](#配置文件部分)
* [安装脚本部分](#安装脚本部分)
   * [ArchLinux安装](#archlinux安装)
   * [软件批量安装](#软件批量安装)
   * [Vim及插件安装](#vim及插件安装)
* [工具脚本部分](#工具脚本部分)
   * [Python虚拟环境快速切换](#python虚拟环境快速切换)
   * [aria2管理&amp;自动更新bt-tracker](#aria2管理自动更新bt-tracker)
   * [本地Docker服务项目管理](#本地docker服务项目管理)
* [Screenshot](#screenshot)
* [TODO](#todo)


## Intro

创建这个repo，是为了减少重复工作，内容主要包含两个部分：
1.  系统/软件配置，包含Vim、i3wm、tmux等
2.  安装脚本
    *   ArchLinux系统安装脚本
    *   软件编译/安装脚本，如Vim-YCM插件
3.  工具脚本
    *   工具脚本，如Docker、Aria2管理


## Usage

此repo中的安装脚本可以由[install.sh](./install.sh)来统一执行

```bash
git clone https://github.com/Karmenzind/dotfiles-and-scripts {target_dir}
cd {target_dir}
./install.sh
```

根据提示执行。


## 配置文件部分

不做具体介绍
> trees are generated by [this script](./utils/build_trees.sh)

- [for XDG_CONFIG_DIR](./home/.config)
	- [.vimrc](./vim/.vimrc)
	- [.tmux.conf](./home/.tmux.conf)
    - [aria2](./home/.config/aria2)
    - [compton.conf](./home/.config/compton.conf)
    - [dunst](./home/.config/dunst)
    - [fontconfig](./home/.config/fontconfig)
    - [i3](./home/.config/i3)
    - [volumeicon](./home/.config/volumeicon)
    - [xfce4](./home/.config/xfce4)
- [other config](./others)
	- [bashrc_ext](./others/bashrc_ext)
	- [fcitx](./others/fcitx)


## 安装脚本部分

### ArchLinux安装

**文件结构：**
- [livecd_part](./scripts/install_arch/livecd_part.sh) LiveCD部分：分区、安装base package等
- [chrooted_part](./scripts/install_arch/chrooted_part.sh) 进入chroot环境之后的部分，直到重启
- [general_recommendations_part](./scripts/install_arch/general_recommendations_part.sh) 安装完成后的一些基础设置
- [graphical_env_part](./scripts/install_arch/graphical_env_part.sh) 安装图形环境，目前支持GNOME kde Xfce4 i3wm

> 上述命名参考对应了ArchWiki中的安装过程

**使用前提：**
*   熟悉ArchLinux安装过程和Bash语法
*   一块独立硬盘（暂不兼容和其他系统混装）
*   设备支持UEFI（采用GPT方式建立分区，后续可能会加入MBR支持）
*   手动配置网络（脚本未包含网络配置相关内容，请参考ArchWiki）

**分区说明：**

脚本提供了两种分区方式，运行脚本时用Y/N选择：
*   自动分区，如下（懒，从脚本拷出来的，就不再描述一遍了）。
第一种是按照ArchWiki推荐的分区方式做的（wiki里认为`/`分区20G够用，我改成了32G），第二种是参考了Manjaro的处理方式。

```
Do you want to use recommended partition table as follows (Y) 
or do the partition by yourself? (N)
recommended table:
1. for a disk larger than 60G:
    550MiB      ESP         for boot
    32GiB       ext4        for ROOT
    8GiB        linux-swap  for SWAP
    remainder   ext4        for HOME
2. for a disk smaller than 60G:
    550MiB      ESP         for BOOT
    remainder   ext4        for ROOT
    (you can create a swapfile by yourself after installation)
```

*   手动分区，进入fdisk交互环境，保存退出。
目前只支持boot、root、swap、home每种用途分区`<=1`个。


**安装步骤：**
确定阅读完上述内容之后，就可以开始安装了。首先用安装介质启动，进入LiveCD环境，参考ArchWiki手动配置好网络。然后：
1. **将安装脚本放入LiveCD环境中，执行liveCD part**。最省力的方法：找一台可以通过ssh登陆的机器（我用的树莓派），通过scp把项目复制到liveCD中。如果没有条件，则运行下面命令尝试安装Git：
```bash
pacman -Sy git
```
如果安装Git成功，则按照FIXME的描述步骤，运行install.sh，依次选择`install ArchLinux`、`livecd part`，依照提示执行。脚本执行结束后已经处于arch-chroot环境，此时进入`/dotfiles-and-scripts`目录，通过`./install.sh`脚本继续执行`chrooted part`。
如果因为空间不足等而安装Git失败，则手动输入:smiling_imp:如下命令执行`livecd part`：
```bash
wget https://raw.githubusercontent.com/Karmenzind/dotfiles-and-scripts/recon/scripts/install_arch/livecd_part.sh
./live_cd_part.sh
```
进入arch-chroot后，参考[这里](#用法)，执行`chrooted part`。
2. **执行chrooted part**。结束后重启，取出存储介质，从系统盘进入Arch。
3. **执行general recommendations part**。至此Arch系统已经安装完成，此步骤对应了ArchWiki中的[这一部分](https://wiki.archlinux.org/index.php/General_recommendations)，其中图形环境部分单独分成第4步。这一步参考[这里](#用法)执行。
4. **安装图形环境**。这一步参考[这里](#用法)执行。


### 软件批量安装

- [install_apps.sh](./scripts/install_apps.sh)

自行修改、添加所需的软件
执行时加入`-y`参数可以免确认安装

### Vim及插件安装

Vim比较特殊，尤其是YCM经常安装失败，所以单独写一个脚本

- [complete installation](./scripts/install_vim/main.sh) 按照我的Vim配置完整安装（TODO：完整编译安装）
- [compile and install YouCompleteMe](./scripts/install_vim/ycm.sh) YouCompleteMe插件编译安装


## 工具脚本部分

### Python虚拟环境快速切换

- [acpyve](./local_bin/acpyve)

方便一堆虚拟环境需要切换的场景<br>

Usage:
在脚本或环境变量中设置虚拟环境存放目录，然后
```bash
k 16:04:00 > ~ $ . acpyve
Pick one virtual environment to activate:

1  General_Py2
2  General_Py3

Input number: 2

Activating General_Py3...
/home/k

DONE :)

(General_Py3) k 16:04:16 > ~
$ 

```

### Aria2管理&自动更新bt-tracker

- [myaria2](./local_bin/myaria2)

功能：
- 启动、重启、停止、查看运行状态、查看日志
- 更新bt-tracker（从ngosang/trackerslist获取）。启动、重启时，配置周期触发更新，也可以通过`myaria2 update`主动更新
- 转存旧日志
- 其他一些简单功能

结合cron使用
配置项见脚本注释

Reference:
-   [trackerslist](https://github.com/ngosang/trackerslist)
-   [解决Aria2 BT下载速度慢没速度的问题](http://www.senra.me/solutions-to-aria2-bt-metalink-download-slowly/)
-   [配置详解](http://www.senra.me/aria2-conf-file-parameters-translation-and-explanation/)
-   [AriaNG——高颜值的Aria2 WebUI](http://www.senra.me/ariang-a-beautiful-aria2-webui-front-end/)
-   [Aria2+Plex实现支持离线下载的小型私人视频云盘](http://www.senra.me/aria2-and-plex-build-your-own-cloud-video-streaming-service/)
-   [下载工具系列——Aria2 (几乎全能的下载神器)](http://www.senra.me/awesome-downloader-series-aria2-almost-the-best-all-platform-downloader/)
-   [下载神器——Aria2，打造你自己的离线下载服务器](http://www.senra.me/download-artifact-aria2-create-your-own-offline-download-server/)

### 本地Docker服务项目管理

- [docker_manager](./local_bin/docker_manager)

方便一堆用Docker容器需要管理的场景<br>
配合cron使用


## Screenshot


i3 desktop:

![desktop.jpg](./pics/desktop.jpg)

Vim:

![vim_common.png](./pics/vim_common.png)
![vim_goyo.png](./pics/vim_goyo.png)

## TODO

- `do_synch.sh` from host to repo... vise versa

